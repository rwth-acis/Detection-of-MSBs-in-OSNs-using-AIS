{% extends "base.html" %}

{% block title %}Result{% endblock %}

{% block html_head %}
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='table_page.css') }}">
    <script>
            $(document).ready(function(){
                $('#main-table').DataTable();
            });
            function load(){
                   var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent("{{users_list}}".replaceAll("&#39;", "\""));
                    var dlAnchorElem = document.getElementById('downloadAnchorElem');
                    dlAnchorElem.setAttribute("href",     dataStr     );
                    dlAnchorElem.setAttribute("download", "scene.json");
                    dlAnchorElem.click();
            }
    </script>
{% endblock %}


{% block content %}
    <div id="div-main-table">
        <table id="main-table">
            <thead>
            <tr>
                <th>Name</th>
                <th>Screen name</th>
                <th>Tweet</th>
                <th>Verified</th>
                <th>Description</th>
                <th>K</th>
                <th>Link</th>


            </tr>
            </thead>

            <tbody>
            {% for user in users %}
            <tr>
                <td>{{user["user"]["name"]}}</td>
                <td>{{user["user"]["screen_name"]}}</td>
                <td>{{user["found_tweet"]["full_text"]}}</td>
                <td>{{user["user"]["verified"]}}</td>
                <td>{{user["user"]["description"]}}</td>
                <td>{{user["signals"]["k"]}}</td>
                <td><a href="http://127.0.0.1:5000/user/{{user['_id']}}" class="btn btn-info">Get more information</a></td>

            </tr>
            {% endfor %}
            </tbody>

        </table>
    </div>
    <a id="downloadAnchorElem" class="btn btn-info" onclick="load();">Download your data</a>
    <div id="map">{{ folium_map }}</div>
{% endblock %}