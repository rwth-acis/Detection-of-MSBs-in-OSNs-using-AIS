{% extends "base.html" %}

{% block title %}Result{% endblock %}

{% block html_head %}
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.anychart.com/releases/8.10.0/js/anychart-core.min.js"></script>
    <script src="https://cdn.anychart.com/releases/8.10.0/js/anychart-pie.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='table_page.css') }}">

{% endblock %}


{% block content %}
    <div id="div-main-table">
        <table id="main-table" data-order='[[ 3, "result-k" ]]'>
            <thead>
            <tr>
                <th>User</th>
                <th>User description</th>
                <th>Tweet</th>
                <th>Is a bot (probability)</th>
                <th>Intentions are bad (probability)</th>
                <th>Link</th>


            </tr>
            </thead>

            <tbody>
            {% for user in users %}
            <tr>

                <td class="user"><a href='https://twitter.com/{{user["user"]["screen_name"]}}'>@{{user["user"]["screen_name"]}}</a> <br> ({{user["user"]["name"]}})</td>


                {% if user["signals"]["identifies_itself_as_bot"] == True %}
                <td class="description"><div class="identifies-itself-as-bot">identifies itself as a bot</div>{{user["user"]["description"]}}</td>
                {% else %}
                <td class="description">{{user["user"]["description"]}}</td>
                {% endif %}

                {% if user["found_tweet"]["truncated"] %}
                <td class="text">{{user["found_tweet"]["retweeted_status"]["full_text"]}}</td>
                {% else %}
                <td class="text"><div class="created-at">{{user["found_tweet"]["created_at"]}}</div>{{user["found_tweet"]["full_text"]}}</td>
                {% endif %}



                <!--<td>{{user["signals"]["k"]}}</td>-->

                <!--{% if user["signals"]["k"] >= 50 %}
                <td class="red"><div class="div-red">{{user["signals"]["k"]}}</div></td>
                {% else %}
                {% if user["signals"]["k"] >= 30 %}
                <td class="orange"><div class="div-orange">{{user["signals"]["k"]}}</div></td>
                {% else %}
                <td class="green"><div class="div-green">{{user["signals"]["k"]}}</div></td>
                {% endif %}
                {% endif %}-->
                {% if user["signals"]["is_bot_probability"] >= 50 %}
                <td class="red"><div class="div-red">{{user["signals"]["is_bot_probability"]}}%</div></td>
                {% else %}
                {% if user["signals"]["is_bot_probability"] >= 30 %}
                <td class="orange"><div class="div-orange">{{user["signals"]["is_bot_probability"]}}%</div></td>
                {% else %}
                <td class="green"><div class="div-green">{{user["signals"]["is_bot_probability"]}}%</div></td>
                {% endif %}
                {% endif %}

                {% if user["signals"]["intentions_are_bad_probability"] >= 50 %}
                <td class="red"><div class="div-red">{{user["signals"]["intentions_are_bad_probability"]}}%</div></td>
                {% else %}
                {% if user["signals"]["intentions_are_bad_probability"] >= 20 %}
                <td class="orange"><div class="div-orange">{{user["signals"]["intentions_are_bad_probability"]}}%</div></td>
                {% else %}
                <td class="green"><div class="div-green">{{user["signals"]["intentions_are_bad_probability"]}}%</div></td>
                {% endif %}
                {% endif %}


                <td><a href="{{app_url}}/user/{{user['_id']}}" class="btn btn-info">Get more information</a></td>

            </tr>
            {% endfor %}
            </tbody>

        </table>
    </div>
    <a id="downloadAnchorElem" class="btn btn-info" onclick="load();">Download your data</a>
    <div id="map">{{ folium_map }}</div>
    <div id="chart-container1">
    </div>
    <div id="chart-container2">
    </div>
    <script>
            $(document).ready(function(){
                $('#main-table').DataTable();

                var data = anychart.data.set([
                  {x:'Positive', value:{{positive_count1}}, normal:  {fill: "#8ed9ff"} },
                  {x:'Negative', value:{{negative_count1}} , normal:  {fill: "#006699"}},
                  {x:'Neutral', value:{{neutral_count1}} , normal:  {fill: "#A8A8A8"}}
                ]);
                // create a pie chart with the data
                var chart = anychart.pie(data)
                // set the chart radius making a donut chart
                chart.innerRadius('55%');
                chart.title('Sentiment analysis of tweets from users who are most likely bots:')
                chart.container('chart-container1');
                chart.hovered().outline().width("10%");
                chart.selected().outline().width("3");
                chart.selected().outline().fill("#455a64");
                chart.selected().outline().stroke(null);
                chart.selected().outline().offset(2);
                chart.draw();

                var data = anychart.data.set([
                  {x:'Positive', value:{{positive_count2}}, normal:  {fill: "#8ed9ff"} },
                  {x:'Negative', value:{{negative_count2}} , normal:  {fill: "#006699"}},
                  {x:'Neutral', value:{{neutral_count2}} , normal:  {fill: "#A8A8A8"}}
                ]);
                // create a pie chart with the data
                var chart = anychart.pie(data)
                // set the chart radius making a donut chart
                chart.innerRadius('55%');
                chart.title('Sentiment analysis of tweets from users who are most likely human beings:')
                chart.container('chart-container2');
                chart.hovered().outline().width("10%");
                chart.selected().outline().width("3");
                chart.selected().outline().fill("#455a64");
                chart.selected().outline().stroke(null);
                chart.selected().outline().offset(2);
                chart.draw();

            });

            function load(){
                   var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent("{{users_list}}".replaceAll("&#39;", "\""));
                    var dlAnchorElem = document.getElementById('downloadAnchorElem');
                    dlAnchorElem.setAttribute("href",     dataStr     );
                    dlAnchorElem.setAttribute("download", "data.json");
            }
    </script>

{% endblock %}